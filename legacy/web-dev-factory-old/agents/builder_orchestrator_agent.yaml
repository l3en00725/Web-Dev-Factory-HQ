name: Builder Orchestrator Agent
model: GPT-5.1
description: >
  Central multi-model orchestrator for the Web-Dev-Factory that coordinates
  scrape, template selection, schema generation, design enhancement, template
  rendering, Astro build, and deployment phases across GPT, Claude, and
  Gemini agents.
inputs:
  - name: siteName
    type: string
    required: true
    description: Directory-safe name for the site under /sites and /output.
  - name: sourceUrl
    type: string
    required: false
    description: Optional legacy site URL to scrape during Phase 0.
  - name: templateName
    type: string
    required: true
    description: Name/identifier of the selected template to initialize and render.
outputs:
  - name: orchestration_plan
    type: markdown
    description: >
      High-level runbook describing how each phase executes and which agents
      are called with which inputs/outputs.
  - name: phase_artifacts
    type: json
    description: >
      Structured references to the key artifacts from each phase (scrape,
      schema, content seed, design, rendering config, built site, deployment).
steps:
  - id: phase_0_scrape
    name: Phase 0 – Scrape legacy site (optional)
    description: >
      If sourceUrl is provided, invoke the Old Site Scraper Agent to produce
      scrape_output_dir, content_inventory, and migration_dataset under
      output/<siteName>.
  - id: phase_1_template_select
    name: Phase 1 – Template selection
    description: >
      Confirm or suggest templateName based on business_type, migration_dataset
      (if available), and Template System Blueprint rules; finalize template
      choice for downstream agents.
  - id: phase_2_schema
    name: Phase 2 – Sanity schema and seeding
    description: >
      Call the Sanity Schema Agent with siteName and SANITY_DATASET, then call
      the Sanity Content Seeder Agent with siteName and brand info (derived
      from migration_dataset or intake docs) to define schemas and initial
      documents.
  - id: phase_3_design_enhancement
    name: Phase 3 – Design enhancement
    description: >
      Invoke the Design Enhancement Agent (Gemini) with the component_list and
      template_rules for templateName to produce updated_component_specs and
      design_recommendations.
  - id: phase_4_render_template
    name: Phase 4 – Template rendering config
    description: >
      Use the Template Rendering Agent to map schema_structure to Astro
      components and generate template_config and rendering_engine_spec for the
      selected template.
  - id: phase_5_build_astro_site
    name: Phase 5 – Build Astro site
    description: >
      Call the Template Initialization Agent to scaffold /sites/[siteName],
      then call the Astro Site Builder Agent with siteName, sanity dataset,
      and template_config to wire routes, layouts, SEO, navigation, and
      footers.
  - id: phase_6_deploy
    name: Phase 6 – Deploy
    description: >
      Describe how a future deploy skill will build the Astro site and trigger
      deployment (e.g. via VERCEL_DEPLOY_HOOK_URL), capturing deployment URLs
      and status as part of phase_artifacts.
  - id: phase_9_og_image_generation
    name: Phase 9 – OG image generation and verification
    description: >
      Verify that the initialized site includes a dynamic OG image module:
      confirm that /api/og (templates/client-base/api/og/route.ts) exists and
      uses the Edge runtime, ensure Sanity settings.ogTemplate is wired to the
      OG template object for per-site defaults, map those fields into the OG
      helper utilities for generating API payloads, and test sample output
      (e.g. /api/og?title=Test) using the Vercel OG Playground to confirm the
      1200x630 render matches the brand style.
  - id: summarize_orchestration
    name: Summarize multi-model workflow
    description: >
      Produce orchestration_plan and phase_artifacts documenting which agent
      handled which responsibilities, how data flowed between them, and which
      environment variables and external services are required per phase.


