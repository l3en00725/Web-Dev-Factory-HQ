---
import Base from '../layouts/Base.astro';
import PageBuilder from '../components/sanity/PageBuilder.astro';
import { getHomepage, getSettings, getNavItems } from '../lib/sanity/queries';

const [homepage, settings, navItems] = await Promise.all([
  getHomepage(),
  getSettings(),
  getNavItems()
]);

const seo = homepage?.seo || {};
const pageTitle = seo.metaTitle || homepage?.title || settings?.title || "Home";
const pageDescription = seo.metaDescription || homepage?.description || settings?.description;
---

<Base 
  title={pageTitle} 
  description={pageDescription} 
  settings={settings}
  navItems={navItems}
  ogImage={seo.ogImage}
>
  {homepage?.pageBuilder ? (
    <PageBuilder sections={homepage.pageBuilder} templateId={homepage.selectedTemplate || settings?.selectedTemplate} />
  ) : (
    // Fallback for empty homepage
    <div class="py-20 text-center">
      <h1 class="text-4xl font-bold">Welcome</h1>
      <p class="text-muted-foreground mt-4">Add sections to the Homepage in Sanity to see them here.</p>
    </div>
  )}
</Base>
