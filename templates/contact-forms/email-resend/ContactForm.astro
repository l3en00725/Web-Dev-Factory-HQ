---
interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<form 
  id="contact-form" 
  class={`space-y-6 max-w-2xl mx-auto ${className}`}
  data-form-type="email-resend"
>
  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <label for="name" class="block text-sm font-medium mb-2 text-gray-700">
        Full Name *
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
        placeholder="John Smith"
      />
    </div>
    
    <div>
      <label for="email" class="block text-sm font-medium mb-2 text-gray-700">
        Email Address *
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
        placeholder="john@example.com"
      />
    </div>
  </div>

  <div>
    <label for="phone" class="block text-sm font-medium mb-2 text-gray-700">
      Phone Number *
    </label>
    <input
      type="tel"
      id="phone"
      name="phone"
      required
      pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="555-555-5555"
    />
    <p class="mt-1 text-sm text-gray-500">Format: 555-555-5555</p>
  </div>

  <div>
    <label for="service_type" class="block text-sm font-medium mb-2 text-gray-700">
      Service Needed
    </label>
    <select
      id="service_type"
      name="service_type"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition bg-white"
    >
      <option value="">Select a service...</option>
      <option value="lawn_care">Lawn Care</option>
      <option value="landscaping">Landscaping</option>
      <option value="maintenance">Property Maintenance</option>
      <option value="snow_removal">Snow Removal</option>
      <option value="other">Other</option>
    </select>
  </div>

  <div>
    <label for="message" class="block text-sm font-medium mb-2 text-gray-700">
      Message
    </label>
    <textarea
      id="message"
      name="message"
      rows="4"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition resize-none"
      placeholder="Tell us about your project..."
    ></textarea>
  </div>

  <div id="form-messages" class="hidden rounded-lg p-4"></div>

  <button
    type="submit"
    class="w-full bg-primary text-white px-8 py-4 rounded-lg font-semibold hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl"
  >
    <span id="submit-text">Request Free Quote</span>
    <span id="submit-loading" class="hidden">Sending...</span>
  </button>
</form>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
  const submitText = document.getElementById('submit-text') as HTMLSpanElement;
  const submitLoading = document.getElementById('submit-loading') as HTMLSpanElement;
  const messagesDiv = document.getElementById('form-messages') as HTMLDivElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Disable button
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    submitLoading.classList.remove('hidden');
    messagesDiv.classList.add('hidden');

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch('/api/submit-form', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        // Success
        messagesDiv.className = 'p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg';
        messagesDiv.textContent = '✓ Thank you! We\'ll contact you within 24 hours.';
        messagesDiv.classList.remove('hidden');
        form.reset();
        
        // Track conversion (Google Analytics)
        if (typeof gtag !== 'undefined') {
          gtag('event', 'form_submit', {
            event_category: 'Contact',
            event_label: form.dataset.formType || 'Contact Form'
          });
        }
        
        // Track conversion (Meta Pixel)
        if (typeof fbq !== 'undefined') {
          fbq('track', 'Lead', {
            content_name: 'Contact Form',
            content_category: form.dataset.formType || 'Contact'
          });
        }
      } else {
        throw new Error('Submission failed');
      }
    } catch (error) {
      // Error
      messagesDiv.className = 'p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
      messagesDiv.textContent = '✗ Something went wrong. Please call us directly.';
      messagesDiv.classList.remove('hidden');
    } finally {
      // Re-enable button
      submitBtn.disabled = false;
      submitText.classList.remove('hidden');
      submitLoading.classList.add('hidden');
    }
  });
</script>

