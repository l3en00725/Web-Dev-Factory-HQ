name: Old Site Scraper Agent
model: GPT-5.1
description: >
  Scrape an existing website to collect HTML, text content, headings, images,
  CTAs, FAQs, and forms into a structured migration-ready dataset under
  output/<site>.
inputs:
  - name: sourceUrl
    type: string
    required: true
    description: Root URL of the legacy site to be scraped.
outputs:
  - name: scrape_output_dir
    type: path
    description: Path to the generated output/<site> folder for this scrape.
  - name: content_inventory
    type: json
    description: >
      Structured map of pages, URLs, headings, body copy, CTAs, and on-page
      sections suitable for import and analysis.
  - name: migration_dataset
    type: json
    description: >
      Normalized dataset summarizing branding elements, forms, FAQs, and copy
      that downstream agents can use during migration.
steps:
  - id: derive_site_slug
    name: Derive site slug from source URL
    description: >
      Convert sourceUrl into a stable slug (e.g. host without protocol) to use
      when naming the data/scraped/ directory.
  - id: run_two_tier_scraper
    name: Execute two-tier scraper (Tier 1: simple HTML → Tier 2: Playwright fallback)
    description: >
      Run scripts/scraper/index.mjs with sourceUrl. The scraper automatically:
      - Tries Tier 1 (fetch + cheerio) first
      - Falls back to Tier 2 (Playwright) if content is missing or JS-rendered
      - Outputs to data/scraped/: site-map.json, pages.json, images.json, service-areas.json
    action:
      run: |
        bun run scripts/scraper/index.mjs --url "${{ inputs.sourceUrl }}" --output "data/scraped"
  - id: extract_page_content
    name: Extract page-level content from scraped data
    description: >
      Read data/scraped/pages.json and extract:
      - URLs, titles, meta descriptions, headings (H1–H3)
      - JSON-LD structured data
      - Internal links
      - Build content_inventory from scraped pages
  - id: collect_media_assets
    name: Collect and map media assets
    description: >
      Read data/scraped/images.json and catalog:
      - Logo, hero images, trust badges
      - Alt text and filenames
      - Create media listing for optimization scripts
  - id: synthesize_migration_dataset
    name: Synthesize migration-ready dataset
    description: >
      Aggregate content_inventory into a migration_dataset that highlights:
      - Branding cues (colors, logo, taglines)
      - Repeated CTAs and messaging patterns
      - Common questions (for FAQs)
      - Form structures and fields
      - Service areas from data/scraped/service-areas.json
      For use by schema, copy, and builder agents.


