---
import Button from '../ui/Button.astro';
import Logo from '../ui/Logo.astro';

interface Props {
  items: { title: string; href: string; active?: boolean }[];
}

const { items } = Astro.props;
---

<div 
  id="mobile-menu" 
  class="fixed inset-0 z-50 translate-x-full transition-transform duration-300 ease-in-out lg:hidden"
  aria-hidden="true"
>
  {/* Backdrop */}
  <div class="absolute inset-0 bg-slate-900/20 backdrop-blur-sm" id="menu-backdrop"></div>

  {/* Drawer */}
  <div class="absolute right-0 top-0 h-full w-[85%] max-w-sm bg-white shadow-2xl flex flex-col">
    <div class="flex items-center justify-between p-6 border-b border-slate-100">
      <div class="w-[130px]">
        <Logo />
      </div>
      <button 
        id="close-menu-btn"
        class="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500"
        aria-label="Close menu"
      >
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <nav class="flex-1 overflow-y-auto px-6 py-8">
      <ul class="flex flex-col gap-2">
        {items.map((item) => (
          <li>
            <a 
              href={item.href} 
              class:list={[
                "block py-3 text-xl font-medium transition-colors rounded-lg px-4",
                item.active 
                  ? "text-primary-700 bg-primary-50" 
                  : "text-slate-600 hover:text-primary-600 hover:bg-slate-50"
              ]}
            >
              {item.title}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <div class="p-6 border-t border-slate-100 bg-slate-50">
      <Button href="/contact" size="lg" variant="primary" class="w-full justify-center shadow-md">
        Get a Free Quote
      </Button>
      <p class="mt-4 text-center text-xs text-slate-500">
        Licensed & Insured â€¢ Cape May County
      </p>
    </div>
  </div>
</div>

<script>
  const menu = document.getElementById('mobile-menu');
  // FIXED: Correct ID 'close-menu-btn' matches markup
  const closeBtn = document.getElementById('close-menu-btn');
  const backdrop = document.getElementById('menu-backdrop');
  
  function closeMenu() {
    if (menu) {
      menu.setAttribute('aria-hidden', 'true');
      menu.classList.add('translate-x-full');
      document.body.style.overflow = '';
    }
  }

  // Toggle logic is driven by custom event 'toggle-menu' dispatched from Header
  document.addEventListener('toggle-menu', () => {
    const isOpen = menu?.getAttribute('aria-hidden') === 'false';
    if (menu) {
      menu.setAttribute('aria-hidden', (!isOpen).toString());
      if (!isOpen) {
        menu.classList.remove('translate-x-full');
        document.body.style.overflow = 'hidden'; // Prevent scroll
      } else {
        closeMenu();
      }
    }
  });

  closeBtn?.addEventListener('click', closeMenu);
  backdrop?.addEventListener('click', closeMenu);
</script>
