---
import Container from '../layout/Container.astro';
import Button from '../ui/Button.astro';
import Image from '../base/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  headline?: string;
  subheadline?: string;
  image?: ImageMetadata | string; // Updated to accept ImageMetadata
  ctaLabel?: string;
  ctaLink?: string;
  secondaryCtaLabel?: string;
  secondaryCtaLink?: string;
  alignment?: 'left' | 'center' | 'right';
  variant?: 'homepage' | 'simple'; // New: Support for simple headers on service/location pages
  // Props requested in prompt (aliased to existing ones if possible, or added)
  title?: string;
  subtitle?: string;
  primaryCta?: { label: string; href: string };
  backgroundImage?: ImageMetadata | string;
}

const {
  headline,
  subheadline,
  image: propImage,
  ctaLabel,
  ctaLink,
  secondaryCtaLabel,
  secondaryCtaLink,
  alignment = 'left',
  variant = 'homepage',
  title,
  subtitle,
  primaryCta,
  backgroundImage
} = Astro.props;

// Normalize props to support both old and new signatures
const finalHeadline = title || headline;
const finalSubheadline = subtitle || subheadline;
const finalImage = backgroundImage || propImage || 'src/assets/images/blue-lawns-avalon-lawn-care-hero.svg';
const finalCtaLabel = primaryCta?.label || ctaLabel;
const finalCtaLink = primaryCta?.href || ctaLink;

const alignClass = {
  left: 'items-start text-left',
  center: 'items-center text-center',
  right: 'items-end text-right',
};

// Testimonial Avatars - Real people from the optimized library
const avatars = [
  'src/assets/images/avatars/avatar-1.png',
  'src/assets/images/avatars/avatar-2.png',
  'src/assets/images/avatars/avatar-3.png',
  'src/assets/images/avatars/avatar-1.png' // Reuse first one to make 4
];

// Conditional rendering based on variant
const isSimple = variant === 'simple';
---

{isSimple ? (
  <!-- Simple Header for Service/Location Pages -->
  <section class="relative overflow-hidden py-20 lg:py-28">
    {/* Optional Background Image Layer with Overlay */}
    {finalImage && (
      <div class="absolute inset-0 z-0">
        <Image
          src={finalImage}
          alt={finalHeadline || "Blue Lawns Service"}
          class="h-full w-full object-cover"
          priority={true}
        />
        {/* White overlay to create subtle effect */}
        <div class="absolute inset-0 bg-gradient-to-b from-white/95 via-white/90 to-white/85"></div>
      </div>
    )}
    
    {/* Fallback gradient if no image */}
    {!finalImage && (
      <div class="absolute inset-0 bg-gradient-to-b from-blue-50 to-white"></div>
    )}
    
    <Container class="relative z-10 flex flex-col items-center text-center gap-6">
      {/* Trust Badge */}
      <div class="inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-4 py-1.5 text-sm font-medium text-primary-700">
        <span class="relative flex h-2 w-2">
          <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-secondary-400 opacity-75"></span>
          <span class="relative inline-flex h-2 w-2 rounded-full bg-secondary-500"></span>
        </span>
        <span class="tracking-wide">The #1 Choice in Cape May County</span>
      </div>

      <div class="max-w-4xl">
        {finalHeadline && (
          <h1 class="font-display text-4xl font-bold leading-tight tracking-tight text-brand-navy lg:text-5xl xl:text-6xl">
            {finalHeadline}
          </h1>
        )}
        {finalSubheadline && (
          <p class="mt-4 max-w-2xl mx-auto text-lg leading-relaxed text-brand-body lg:text-xl">
            {finalSubheadline}
          </p>
        )}
      </div>

      <div class="mt-4 flex flex-col gap-4 sm:flex-row">
        {finalCtaLabel && finalCtaLink && (
          <Button 
            href={finalCtaLink} 
            size="lg" 
            variant="primary"
            track={true}
            class="min-w-[180px] bg-secondary-500 text-white hover:bg-secondary-600"
          >
            {finalCtaLabel}
          </Button>
        )}
        {secondaryCtaLabel && secondaryCtaLink && (
          <Button
            href={secondaryCtaLink}
            size="lg"
            variant="outline"
            track={true}
            class="min-w-[180px] border-primary-300 text-primary-700 hover:bg-primary-50"
          >
            {secondaryCtaLabel}
          </Button>
        )}
      </div>
    </Container>
  </section>
) : (
  <!-- Original Homepage Hero -->

<section class="relative flex min-h-[90vh] w-full items-center justify-center overflow-hidden bg-primary-950">
  {/* Background Image Layer */}
  <div class="absolute inset-0 z-0 select-none">
    {finalImage ? (
      <div class="relative h-full w-full">
        <Image
          src={finalImage}
          alt={finalHeadline || "Blue Lawns Coastal Landscape"}
          class="h-full w-full object-cover object-center opacity-90"
          priority={true}
        />
      </div>
    ) : (
      <div class="h-full w-full bg-gradient-to-br from-primary-900 to-slate-900"></div>
    )}

    {/* Coastal Premium Overlays */}
    {/* 1. Darken bottom for text readability */}
    <div class="absolute inset-0 bg-gradient-to-t from-primary-950/95 via-primary-950/50 to-primary-950/20"></div>
    
    {/* 2. Blue/Teal tint overlay for brand consistency */}
    <div class="absolute inset-0 bg-primary-900/20 mix-blend-overlay"></div>
    
    {/* 3. Radial sheen top-right */}
    <div class="absolute -top-1/4 -right-1/4 h-[800px] w-[800px] rounded-full bg-secondary-400/20 blur-[120px]"></div>
  </div>

  <Container class={`relative z-10 mt-20 flex flex-col gap-8 ${alignClass[alignment]}`}>
    {/* Premium Trust Badge */}
    <div class="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-1.5 text-sm font-medium text-white backdrop-blur-md transition-colors hover:bg-white/20">
      <span class="relative flex h-2 w-2">
        <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-secondary-400 opacity-75"></span>
        <span class="relative inline-flex h-2 w-2 rounded-full bg-secondary-500"></span>
      </span>
      <span class="tracking-wide">The #1 Choice in Cape May County</span>
    </div>

    <div class="max-w-4xl">
      {finalHeadline && (
        <h1 class="font-display text-5xl font-bold leading-[1.1] tracking-tight text-white drop-shadow-lg lg:text-7xl xl:text-8xl">
          {finalHeadline.split('<br/>').map((line) => (
             <span class="block">{line}</span>
          ))}
        </h1>
      )}
      {finalSubheadline && (
        <p class="mt-6 max-w-2xl text-xl leading-relaxed text-primary-50 drop-shadow-md lg:text-2xl font-light opacity-90">
          {finalSubheadline}
        </p>
      )}
    </div>

    <div class="mt-4 flex flex-col gap-4 sm:flex-row">
      {finalCtaLabel && finalCtaLink && (
        <Button 
          href={finalCtaLink} 
          size="lg" 
          variant="primary"
          track={true}
          class="min-w-[180px] border-transparent bg-secondary-500 text-white shadow-xl shadow-secondary-900/20 hover:bg-secondary-600 hover:-translate-y-1 transition-all duration-300"
        >
          {finalCtaLabel}
        </Button>
      )}
      {secondaryCtaLabel && secondaryCtaLink && (
        <Button
          href={secondaryCtaLink}
          size="lg"
          variant="outline"
          track={true}
          class="min-w-[180px] border-white/30 bg-white/5 text-white backdrop-blur-md hover:bg-white/15 hover:border-white/50 hover:-translate-y-1 transition-all duration-300"
        >
          {secondaryCtaLabel}
        </Button>
      )}
    </div>

    {/* Social Proof */}
    <div class="mt-10 flex items-center gap-4 rounded-2xl border border-white/10 bg-primary-950/30 px-6 py-3 backdrop-blur-sm">
       <div class="flex -space-x-3">
        {avatars.map((src, i) => (
          <div class="h-10 w-10 rounded-full border-2 border-primary-900 bg-slate-200 overflow-hidden relative">
            <Image 
              src={src} 
              alt={`Trusted neighbor ${i + 1}`}
              class="h-full w-full object-cover"
              width={40}
              height={40}
            />
          </div>
        ))}
      </div>
      <div class="flex flex-col">
        <div class="flex text-secondary-400 text-sm">
          {'★★★★★'.split('').map(star => <span>{star}</span>)}
        </div>
        <span class="text-sm font-medium text-white/90">Trusted by 500+ Neighbors</span>
      </div>
    </div>
  </Container>

  {/* Smooth Transition to Content */}
  <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-background to-transparent"></div>
</section>
)}
