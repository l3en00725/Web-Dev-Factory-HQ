---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { resolveImage } from '../../lib/image-helper';

interface Props {
  src: string | ImageMetadata;
  alt: string;
  width?: number;
  height?: number;
  sizes?: string;
  priority?: boolean;
  class?: string;
  quality?: number;
  format?: 'webp' | 'avif' | 'png' | 'jpeg';
  fit?: 'cover' | 'contain' | 'fill' | 'none' | 'scale-down'; // Keep for compatibility, though explicit class preferred
  fetchpriority?: 'high' | 'low' | 'auto';
}

const { 
  src, 
  alt = "Blue Lawns Image", 
  width, 
  height, 
  sizes = "(max-width: 768px) 100vw, 50vw",
  priority = false,
  class: className,
  quality = 80,
  format = 'webp',
  fit, // extracted but not passed to Image directly as style, unless needed
  fetchpriority
} = Astro.props;

let finalSrc: ImageMetadata | string | undefined = src;

if (typeof src === 'string') {
  // Check if remote URL
  if (src.startsWith('http')) {
     finalSrc = src;
  } else {
     // Resolve local image path
     finalSrc = resolveImage(src);
  }
}

const loading = priority ? "eager" : "lazy";

// If resolution failed, fallback or null (could add a placeholder logic here)
// For now, if no image found, we render nothing or broken image behavior.
---

{finalSrc ? (
  <Image 
    src={finalSrc} 
    alt={alt}
    width={width}
    height={height}
    sizes={sizes}
    loading={loading}
    class={className}
    quality={quality}
    format={format}
    fetchpriority={fetchpriority}
  />
) : (
  <div class={`bg-gray-200 flex items-center justify-center text-gray-400 text-xs ${className}`}>
    Image not found
  </div>
)}
